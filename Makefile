TEST_FLAGS=-fcf-protection=full -fno-stack-protector -no-pie -w
CFBENDING_FLAGS=-fcf-protection=full -fno-stack-protector -no-pie -w
DOP_FLAGS=-fcf-protection=full -fno-stack-protector -no-pie -w -g
COOP_FLAGS=-fcf-protection=full -fno-stack-protector -no-pie -w -g

all: mkbin cfbending dop coop test
	@echo "All targets built!"

clean:
	rm -r ./bin

mkbin:
	@if [ ! -d ./bin ]; then mkdir bin && echo "Created directory ./bin"; fi
	
test: mkbin
	gcc ${TEST_FLAGS} -o ./bin/test_shstk ./tests/test_shstk.c
	gcc ${TEST_FLAGS} -o ./bin/test_exec_shstk ./tests/test_exec_shstk.c

cfbending: mkbin
	gcc ${CFBENDING_FLAGS} -o ./bin/exec_hijack ./cfbending/exec_hijack.c
	gcc ${CFBENDING_FLAGS} -o ./bin/exec_hijack_realistic ./cfbending/exec_hijack_realistic.c
	g++ ${CFBENDING_FLAGS} -znow -o ./bin/vtable_hijack ./cfbending/vtable_hijack.cpp

dop: mkbin
	gcc ${DOP_FLAGS} -o ./bin/enc_database ./dop/enc_database.c

coop: mkbin
	g++ ${COOP_FLAGS} -o ./bin/destructor_hijack ./coop/destructor_hijack.cpp


